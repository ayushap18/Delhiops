import{c as Ue,a as He,u as Pe,s as Fe,r as m,e as _,j as l,k as re,x as qe,m as Ke,y as Ye,q as Be}from"./index-LIPNnWQ7.js";import{C as Ve}from"./clock-Bk-JXcit.js";import{Z as We}from"./zap-BZ7WlmBL.js";import{A as Je}from"./activity-BiL81ND9.js";const ze=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],Qe=Ue("loader-circle",ze);var ce;(function(e){e.STRING="string",e.NUMBER="number",e.INTEGER="integer",e.BOOLEAN="boolean",e.ARRAY="array",e.OBJECT="object"})(ce||(ce={}));var le;(function(e){e.LANGUAGE_UNSPECIFIED="language_unspecified",e.PYTHON="python"})(le||(le={}));var de;(function(e){e.OUTCOME_UNSPECIFIED="outcome_unspecified",e.OUTCOME_OK="outcome_ok",e.OUTCOME_FAILED="outcome_failed",e.OUTCOME_DEADLINE_EXCEEDED="outcome_deadline_exceeded"})(de||(de={}));const ue=["user","model","function","system"];var fe;(function(e){e.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",e.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",e.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",e.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",e.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",e.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY"})(fe||(fe={}));var he;(function(e){e.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",e.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",e.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",e.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",e.BLOCK_NONE="BLOCK_NONE"})(he||(he={}));var me;(function(e){e.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",e.NEGLIGIBLE="NEGLIGIBLE",e.LOW="LOW",e.MEDIUM="MEDIUM",e.HIGH="HIGH"})(me||(me={}));var ge;(function(e){e.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",e.SAFETY="SAFETY",e.OTHER="OTHER"})(ge||(ge={}));var U;(function(e){e.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",e.STOP="STOP",e.MAX_TOKENS="MAX_TOKENS",e.SAFETY="SAFETY",e.RECITATION="RECITATION",e.LANGUAGE="LANGUAGE",e.BLOCKLIST="BLOCKLIST",e.PROHIBITED_CONTENT="PROHIBITED_CONTENT",e.SPII="SPII",e.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",e.OTHER="OTHER"})(U||(U={}));var Ee;(function(e){e.TASK_TYPE_UNSPECIFIED="TASK_TYPE_UNSPECIFIED",e.RETRIEVAL_QUERY="RETRIEVAL_QUERY",e.RETRIEVAL_DOCUMENT="RETRIEVAL_DOCUMENT",e.SEMANTIC_SIMILARITY="SEMANTIC_SIMILARITY",e.CLASSIFICATION="CLASSIFICATION",e.CLUSTERING="CLUSTERING"})(Ee||(Ee={}));var pe;(function(e){e.MODE_UNSPECIFIED="MODE_UNSPECIFIED",e.AUTO="AUTO",e.ANY="ANY",e.NONE="NONE"})(pe||(pe={}));var ye;(function(e){e.MODE_UNSPECIFIED="MODE_UNSPECIFIED",e.MODE_DYNAMIC="MODE_DYNAMIC"})(ye||(ye={}));class R extends Error{constructor(t){super(`[GoogleGenerativeAI Error]: ${t}`)}}class G extends R{constructor(t,n){super(t),this.response=n}}class be extends R{constructor(t,n,s,o){super(t),this.status=n,this.statusText=s,this.errorDetails=o}}class M extends R{}class Ae extends R{}const Xe="https://generativelanguage.googleapis.com",Ze="v1beta",et="0.24.1",tt="genai-js";var j;(function(e){e.GENERATE_CONTENT="generateContent",e.STREAM_GENERATE_CONTENT="streamGenerateContent",e.COUNT_TOKENS="countTokens",e.EMBED_CONTENT="embedContent",e.BATCH_EMBED_CONTENTS="batchEmbedContents"})(j||(j={}));class nt{constructor(t,n,s,o,a){this.model=t,this.task=n,this.apiKey=s,this.stream=o,this.requestOptions=a}toString(){var t,n;const s=((t=this.requestOptions)===null||t===void 0?void 0:t.apiVersion)||Ze;let a=`${((n=this.requestOptions)===null||n===void 0?void 0:n.baseUrl)||Xe}/${s}/${this.model}:${this.task}`;return this.stream&&(a+="?alt=sse"),a}}function st(e){const t=[];return e?.apiClient&&t.push(e.apiClient),t.push(`${tt}/${et}`),t.join(" ")}async function ot(e){var t;const n=new Headers;n.append("Content-Type","application/json"),n.append("x-goog-api-client",st(e.requestOptions)),n.append("x-goog-api-key",e.apiKey);let s=(t=e.requestOptions)===null||t===void 0?void 0:t.customHeaders;if(s){if(!(s instanceof Headers))try{s=new Headers(s)}catch(o){throw new M(`unable to convert customHeaders value ${JSON.stringify(s)} to Headers: ${o.message}`)}for(const[o,a]of s.entries()){if(o==="x-goog-api-key")throw new M(`Cannot set reserved header name ${o}`);if(o==="x-goog-api-client")throw new M(`Header name ${o} can only be set using the apiClient field`);n.append(o,a)}}return n}async function at(e,t,n,s,o,a){const r=new nt(e,t,n,s,a);return{url:r.toString(),fetchOptions:Object.assign(Object.assign({},lt(a)),{method:"POST",headers:await ot(r),body:o})}}async function F(e,t,n,s,o,a={},r=fetch){const{url:u,fetchOptions:h}=await at(e,t,n,s,o,a);return it(u,h,r)}async function it(e,t,n=fetch){let s;try{s=await n(e,t)}catch(o){rt(o,e)}return s.ok||await ct(s,e),s}function rt(e,t){let n=e;throw n.name==="AbortError"?(n=new Ae(`Request aborted when fetching ${t.toString()}: ${e.message}`),n.stack=e.stack):e instanceof be||e instanceof M||(n=new R(`Error fetching from ${t.toString()}: ${e.message}`),n.stack=e.stack),n}async function ct(e,t){let n="",s;try{const o=await e.json();n=o.error.message,o.error.details&&(n+=` ${JSON.stringify(o.error.details)}`,s=o.error.details)}catch{}throw new be(`Error fetching from ${t.toString()}: [${e.status} ${e.statusText}] ${n}`,e.status,e.statusText,s)}function lt(e){const t={};if(e?.signal!==void 0||e?.timeout>=0){const n=new AbortController;e?.timeout>=0&&setTimeout(()=>n.abort(),e.timeout),e?.signal&&e.signal.addEventListener("abort",()=>{n.abort()}),t.signal=n.signal}return t}function Q(e){return e.text=()=>{if(e.candidates&&e.candidates.length>0){if(e.candidates.length>1&&console.warn(`This response had ${e.candidates.length} candidates. Returning text from the first candidate only. Access response.candidates directly to use the other candidates.`),Y(e.candidates[0]))throw new G(`${D(e)}`,e);return dt(e)}else if(e.promptFeedback)throw new G(`Text not available. ${D(e)}`,e);return""},e.functionCall=()=>{if(e.candidates&&e.candidates.length>0){if(e.candidates.length>1&&console.warn(`This response had ${e.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),Y(e.candidates[0]))throw new G(`${D(e)}`,e);return console.warn("response.functionCall() is deprecated. Use response.functionCalls() instead."),Ce(e)[0]}else if(e.promptFeedback)throw new G(`Function call not available. ${D(e)}`,e)},e.functionCalls=()=>{if(e.candidates&&e.candidates.length>0){if(e.candidates.length>1&&console.warn(`This response had ${e.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),Y(e.candidates[0]))throw new G(`${D(e)}`,e);return Ce(e)}else if(e.promptFeedback)throw new G(`Function call not available. ${D(e)}`,e)},e}function dt(e){var t,n,s,o;const a=[];if(!((n=(t=e.candidates)===null||t===void 0?void 0:t[0].content)===null||n===void 0)&&n.parts)for(const r of(o=(s=e.candidates)===null||s===void 0?void 0:s[0].content)===null||o===void 0?void 0:o.parts)r.text&&a.push(r.text),r.executableCode&&a.push("\n```"+r.executableCode.language+`
`+r.executableCode.code+"\n```\n"),r.codeExecutionResult&&a.push("\n```\n"+r.codeExecutionResult.output+"\n```\n");return a.length>0?a.join(""):""}function Ce(e){var t,n,s,o;const a=[];if(!((n=(t=e.candidates)===null||t===void 0?void 0:t[0].content)===null||n===void 0)&&n.parts)for(const r of(o=(s=e.candidates)===null||s===void 0?void 0:s[0].content)===null||o===void 0?void 0:o.parts)r.functionCall&&a.push(r.functionCall);if(a.length>0)return a}const ut=[U.RECITATION,U.SAFETY,U.LANGUAGE];function Y(e){return!!e.finishReason&&ut.includes(e.finishReason)}function D(e){var t,n,s;let o="";if((!e.candidates||e.candidates.length===0)&&e.promptFeedback)o+="Response was blocked",!((t=e.promptFeedback)===null||t===void 0)&&t.blockReason&&(o+=` due to ${e.promptFeedback.blockReason}`),!((n=e.promptFeedback)===null||n===void 0)&&n.blockReasonMessage&&(o+=`: ${e.promptFeedback.blockReasonMessage}`);else if(!((s=e.candidates)===null||s===void 0)&&s[0]){const a=e.candidates[0];Y(a)&&(o+=`Candidate was blocked due to ${a.finishReason}`,a.finishMessage&&(o+=`: ${a.finishMessage}`))}return o}function H(e){return this instanceof H?(this.v=e,this):new H(e)}function ft(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var s=n.apply(e,t||[]),o,a=[];return o={},r("next"),r("throw"),r("return"),o[Symbol.asyncIterator]=function(){return this},o;function r(g){s[g]&&(o[g]=function(E){return new Promise(function(p,N){a.push([g,E,p,N])>1||u(g,E)})})}function u(g,E){try{h(s[g](E))}catch(p){b(a[0][3],p)}}function h(g){g.value instanceof H?Promise.resolve(g.value.v).then(S,O):b(a[0][2],g)}function S(g){u("next",g)}function O(g){u("throw",g)}function b(g,E){g(E),a.shift(),a.length&&u(a[0][0],a[0][1])}}const Re=/^data\: (.*)(?:\n\n|\r\r|\r\n\r\n)/;function ht(e){const t=e.body.pipeThrough(new TextDecoderStream("utf8",{fatal:!0})),n=Et(t),[s,o]=n.tee();return{stream:gt(s),response:mt(o)}}async function mt(e){const t=[],n=e.getReader();for(;;){const{done:s,value:o}=await n.read();if(s)return Q(pt(t));t.push(o)}}function gt(e){return ft(this,arguments,function*(){const n=e.getReader();for(;;){const{value:s,done:o}=yield H(n.read());if(o)break;yield yield H(Q(s))}})}function Et(e){const t=e.getReader();return new ReadableStream({start(s){let o="";return a();function a(){return t.read().then(({value:r,done:u})=>{if(u){if(o.trim()){s.error(new R("Failed to parse stream"));return}s.close();return}o+=r;let h=o.match(Re),S;for(;h;){try{S=JSON.parse(h[1])}catch{s.error(new R(`Error parsing JSON response: "${h[1]}"`));return}s.enqueue(S),o=o.substring(h[0].length),h=o.match(Re)}return a()}).catch(r=>{let u=r;throw u.stack=r.stack,u.name==="AbortError"?u=new Ae("Request aborted when reading from the stream"):u=new R("Error reading from the stream"),u})}}})}function pt(e){const t=e[e.length-1],n={promptFeedback:t?.promptFeedback};for(const s of e){if(s.candidates){let o=0;for(const a of s.candidates)if(n.candidates||(n.candidates=[]),n.candidates[o]||(n.candidates[o]={index:o}),n.candidates[o].citationMetadata=a.citationMetadata,n.candidates[o].groundingMetadata=a.groundingMetadata,n.candidates[o].finishReason=a.finishReason,n.candidates[o].finishMessage=a.finishMessage,n.candidates[o].safetyRatings=a.safetyRatings,a.content&&a.content.parts){n.candidates[o].content||(n.candidates[o].content={role:a.content.role||"user",parts:[]});const r={};for(const u of a.content.parts)u.text&&(r.text=u.text),u.functionCall&&(r.functionCall=u.functionCall),u.executableCode&&(r.executableCode=u.executableCode),u.codeExecutionResult&&(r.codeExecutionResult=u.codeExecutionResult),Object.keys(r).length===0&&(r.text=""),n.candidates[o].content.parts.push(r)}o++}s.usageMetadata&&(n.usageMetadata=s.usageMetadata)}return n}async function _e(e,t,n,s){const o=await F(t,j.STREAM_GENERATE_CONTENT,e,!0,JSON.stringify(n),s);return ht(o)}async function we(e,t,n,s){const a=await(await F(t,j.GENERATE_CONTENT,e,!1,JSON.stringify(n),s)).json();return{response:Q(a)}}function Te(e){if(e!=null){if(typeof e=="string")return{role:"system",parts:[{text:e}]};if(e.text)return{role:"system",parts:[e]};if(e.parts)return e.role?e:{role:"system",parts:e.parts}}}function P(e){let t=[];if(typeof e=="string")t=[{text:e}];else for(const n of e)typeof n=="string"?t.push({text:n}):t.push(n);return yt(t)}function yt(e){const t={role:"user",parts:[]},n={role:"function",parts:[]};let s=!1,o=!1;for(const a of e)"functionResponse"in a?(n.parts.push(a),o=!0):(t.parts.push(a),s=!0);if(s&&o)throw new R("Within a single message, FunctionResponse cannot be mixed with other type of part in the request for sending chat message.");if(!s&&!o)throw new R("No content is provided for sending chat message.");return s?t:n}function Ct(e,t){var n;let s={model:t?.model,generationConfig:t?.generationConfig,safetySettings:t?.safetySettings,tools:t?.tools,toolConfig:t?.toolConfig,systemInstruction:t?.systemInstruction,cachedContent:(n=t?.cachedContent)===null||n===void 0?void 0:n.name,contents:[]};const o=e.generateContentRequest!=null;if(e.contents){if(o)throw new M("CountTokensRequest must have one of contents or generateContentRequest, not both.");s.contents=e.contents}else if(o)s=Object.assign(Object.assign({},s),e.generateContentRequest);else{const a=P(e);s.contents=[a]}return{generateContentRequest:s}}function Ne(e){let t;return e.contents?t=e:t={contents:[P(e)]},e.systemInstruction&&(t.systemInstruction=Te(e.systemInstruction)),t}function Rt(e){return typeof e=="string"||Array.isArray(e)?{content:P(e)}:e}const xe=["text","inlineData","functionCall","functionResponse","executableCode","codeExecutionResult"],Nt={user:["text","inlineData"],function:["functionResponse"],model:["text","functionCall","executableCode","codeExecutionResult"],system:["text"]};function xt(e){let t=!1;for(const n of e){const{role:s,parts:o}=n;if(!t&&s!=="user")throw new R(`First content should be with role 'user', got ${s}`);if(!ue.includes(s))throw new R(`Each item should include role field. Got ${s} but valid roles are: ${JSON.stringify(ue)}`);if(!Array.isArray(o))throw new R("Content should have 'parts' property with an array of Parts");if(o.length===0)throw new R("Each Content should have at least one part");const a={text:0,inlineData:0,functionCall:0,functionResponse:0,fileData:0,executableCode:0,codeExecutionResult:0};for(const u of o)for(const h of xe)h in u&&(a[h]+=1);const r=Nt[s];for(const u of xe)if(!r.includes(u)&&a[u]>0)throw new R(`Content with role '${s}' can't contain '${u}' part`);t=!0}}function Ie(e){var t;if(e.candidates===void 0||e.candidates.length===0)return!1;const n=(t=e.candidates[0])===null||t===void 0?void 0:t.content;if(n===void 0||n.parts===void 0||n.parts.length===0)return!1;for(const s of n.parts)if(s===void 0||Object.keys(s).length===0||s.text!==void 0&&s.text==="")return!1;return!0}const Se="SILENT_ERROR";class It{constructor(t,n,s,o={}){this.model=n,this.params=s,this._requestOptions=o,this._history=[],this._sendPromise=Promise.resolve(),this._apiKey=t,s?.history&&(xt(s.history),this._history=s.history)}async getHistory(){return await this._sendPromise,this._history}async sendMessage(t,n={}){var s,o,a,r,u,h;await this._sendPromise;const S=P(t),O={safetySettings:(s=this.params)===null||s===void 0?void 0:s.safetySettings,generationConfig:(o=this.params)===null||o===void 0?void 0:o.generationConfig,tools:(a=this.params)===null||a===void 0?void 0:a.tools,toolConfig:(r=this.params)===null||r===void 0?void 0:r.toolConfig,systemInstruction:(u=this.params)===null||u===void 0?void 0:u.systemInstruction,cachedContent:(h=this.params)===null||h===void 0?void 0:h.cachedContent,contents:[...this._history,S]},b=Object.assign(Object.assign({},this._requestOptions),n);let g;return this._sendPromise=this._sendPromise.then(()=>we(this._apiKey,this.model,O,b)).then(E=>{var p;if(Ie(E.response)){this._history.push(S);const N=Object.assign({parts:[],role:"model"},(p=E.response.candidates)===null||p===void 0?void 0:p[0].content);this._history.push(N)}else{const N=D(E.response);N&&console.warn(`sendMessage() was unsuccessful. ${N}. Inspect response object for details.`)}g=E}).catch(E=>{throw this._sendPromise=Promise.resolve(),E}),await this._sendPromise,g}async sendMessageStream(t,n={}){var s,o,a,r,u,h;await this._sendPromise;const S=P(t),O={safetySettings:(s=this.params)===null||s===void 0?void 0:s.safetySettings,generationConfig:(o=this.params)===null||o===void 0?void 0:o.generationConfig,tools:(a=this.params)===null||a===void 0?void 0:a.tools,toolConfig:(r=this.params)===null||r===void 0?void 0:r.toolConfig,systemInstruction:(u=this.params)===null||u===void 0?void 0:u.systemInstruction,cachedContent:(h=this.params)===null||h===void 0?void 0:h.cachedContent,contents:[...this._history,S]},b=Object.assign(Object.assign({},this._requestOptions),n),g=_e(this._apiKey,this.model,O,b);return this._sendPromise=this._sendPromise.then(()=>g).catch(E=>{throw new Error(Se)}).then(E=>E.response).then(E=>{if(Ie(E)){this._history.push(S);const p=Object.assign({},E.candidates[0].content);p.role||(p.role="model"),this._history.push(p)}else{const p=D(E);p&&console.warn(`sendMessageStream() was unsuccessful. ${p}. Inspect response object for details.`)}}).catch(E=>{E.message!==Se&&console.error(E)}),g}}async function St(e,t,n,s){return(await F(t,j.COUNT_TOKENS,e,!1,JSON.stringify(n),s)).json()}async function vt(e,t,n,s){return(await F(t,j.EMBED_CONTENT,e,!1,JSON.stringify(n),s)).json()}async function Ot(e,t,n,s){const o=n.requests.map(r=>Object.assign(Object.assign({},r),{model:t}));return(await F(t,j.BATCH_EMBED_CONTENTS,e,!1,JSON.stringify({requests:o}),s)).json()}class ve{constructor(t,n,s={}){this.apiKey=t,this._requestOptions=s,n.model.includes("/")?this.model=n.model:this.model=`models/${n.model}`,this.generationConfig=n.generationConfig||{},this.safetySettings=n.safetySettings||[],this.tools=n.tools,this.toolConfig=n.toolConfig,this.systemInstruction=Te(n.systemInstruction),this.cachedContent=n.cachedContent}async generateContent(t,n={}){var s;const o=Ne(t),a=Object.assign(Object.assign({},this._requestOptions),n);return we(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(s=this.cachedContent)===null||s===void 0?void 0:s.name},o),a)}async generateContentStream(t,n={}){var s;const o=Ne(t),a=Object.assign(Object.assign({},this._requestOptions),n);return _e(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(s=this.cachedContent)===null||s===void 0?void 0:s.name},o),a)}startChat(t){var n;return new It(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(n=this.cachedContent)===null||n===void 0?void 0:n.name},t),this._requestOptions)}async countTokens(t,n={}){const s=Ct(t,{model:this.model,generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:this.cachedContent}),o=Object.assign(Object.assign({},this._requestOptions),n);return St(this.apiKey,this.model,s,o)}async embedContent(t,n={}){const s=Rt(t),o=Object.assign(Object.assign({},this._requestOptions),n);return vt(this.apiKey,this.model,s,o)}async batchEmbedContents(t,n={}){const s=Object.assign(Object.assign({},this._requestOptions),n);return Ot(this.apiKey,this.model,t,s)}}class bt{constructor(t){this.apiKey=t}getGenerativeModel(t,n){if(!t.model)throw new R("Must provide a model name. Example: genai.getGenerativeModel({ model: 'my-model-name' })");return new ve(this.apiKey,t,n)}getGenerativeModelFromCachedContent(t,n,s){if(!t.name)throw new M("Cached content must contain a `name` field.");if(!t.model)throw new M("Cached content must contain a `model` field.");const o=["model","systemInstruction"];for(const r of o)if(n?.[r]&&t[r]&&n?.[r]!==t[r]){if(r==="model"){const u=n.model.startsWith("models/")?n.model.replace("models/",""):n.model,h=t.model.startsWith("models/")?t.model.replace("models/",""):t.model;if(u===h)continue}throw new M(`Different value for "${r}" specified in modelParams (${n[r]}) and cachedContent (${t[r]})`)}const a=Object.assign(Object.assign({},n),{model:t.model,tools:t.tools,toolConfig:t.toolConfig,systemInstruction:t.systemInstruction,cachedContent:t});return new ve(this.apiKey,a,s)}}const At=["/agent","/search","/api","/help","/clear","/history","/system","/whoami","/exit"],_t=Date.now(),wt={input:"text-brand",system:"text-gray-400",error:"text-danger",ai:"text-info",search:"text-warning",info:"text-gray-300",success:"text-brand",json:"text-gray-300"},Tt=`
  ██████╗ ███████╗██╗     ██╗  ██╗██╗     ██████╗ ██████╗ ███████╗
  ██╔══██╗██╔════╝██║     ██║  ██║██║    ██╔═══██╗██╔══██╗██╔════╝
  ██║  ██║█████╗  ██║     ███████║██║    ██║   ██║██████╔╝███████╗
  ██║  ██║██╔══╝  ██║     ██╔══██║██║    ██║   ██║██╔═══╝ ╚════██║
  ██████╔╝███████╗███████╗██║  ██║██║    ╚██████╔╝██║     ███████║
  ╚═════╝ ╚══════╝╚══════╝╚═╝  ╚═╝╚═╝     ╚═════╝ ╚═╝     ╚══════╝
`,Dt="AIzaSyCusq3QqwlvshdCucbuyooldzJWLfzi0qA",Mt=new bt(Dt),Lt=["gemini-2.0-flash","gemini-1.5-flash","gemini-1.5-flash-latest"];async function Oe(e,t=2){let n=null;for(const s of Lt)for(let o=0;o<=t;o++)try{return(await Mt.getGenerativeModel({model:s}).generateContent(e)).response.text()}catch(a){n=a instanceof Error?a:new Error(String(a));const r=n.message;if(r.includes("429")&&o<t){const u=r.match(/retry.*?(\d+(?:\.\d+)?)\s*s/i),h=u?parseFloat(u[1]):10;await new Promise(S=>setTimeout(S,(h+1)*1e3));continue}if(r.includes("limit: 0"))break;break}throw n??new Error("All Gemini models failed")}let jt=0;function w(){return`line-${Date.now()}-${++jt}`}function Gt(e){return e.toLocaleTimeString("en-IN",{hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1})}function kt(e){const t=Math.floor(e/1e3),n=Math.floor(t/3600),s=Math.floor(t%3600/60),o=t%60;return`${String(n).padStart(2,"0")}:${String(s).padStart(2,"0")}:${String(o).padStart(2,"0")}`}function z(e){try{return JSON.stringify(e,null,2)}catch{return String(e)}}function Ft(){const e=He(),{user:t,isAdmin:n,canWrite:s}=Pe();Fe();const[o,a]=m.useState([]),[r,u]=m.useState(""),[h,S]=m.useState([]),[O,b]=m.useState(-1),[g,E]=m.useState(""),[p,N]=m.useState(!1),[B,De]=m.useState(0),[k,Me]=m.useState("00:00:00"),[V,W]=m.useState("online"),J=m.useRef(null),q=m.useRef(null),Le=m.useRef(null);m.useEffect(()=>{const d=setInterval(()=>{Me(kt(Date.now()-_t))},1e3);return()=>clearInterval(d)},[]),m.useEffect(()=>{const d=async()=>{try{await _.get("/health"),W("online")}catch{try{await _.get("/incidents",{params:{limit:1}}),W("online")}catch{W("offline")}}};d();const c=setInterval(d,3e4);return()=>clearInterval(c)},[]),m.useEffect(()=>{const d=[...Tt.split(`
`).map(c=>({id:w(),timestamp:new Date,text:c,type:"success"})),{id:w(),timestamp:new Date,text:"",type:"system"},{id:w(),timestamp:new Date,text:"  DELHI_OPS_AI_TERMINAL v1.0 // POWERED BY GEMINI",type:"ai"},{id:w(),timestamp:new Date,text:`  SESSION INITIALIZED // USER: ${t?.email??"UNKNOWN"} // ROLE: ${t?.role??"N/A"}`,type:"system"},{id:w(),timestamp:new Date,text:`  BACKEND: ${_.defaults.baseURL??"DEFAULT"} // STATUS: CONNECTED`,type:"system"},{id:w(),timestamp:new Date,text:"",type:"system"},{id:w(),timestamp:new Date,text:"  Type /help to see available commands.",type:"info"},{id:w(),timestamp:new Date,text:"  ──────────────────────────────────────────────",type:"system"}];a(d),setTimeout(()=>J.current?.focus(),100)},[]),m.useEffect(()=>{q.current&&(q.current.scrollTop=q.current.scrollHeight)},[o]),m.useEffect(()=>{if(!r||!r.startsWith("/")){E("");return}const d=r.toLowerCase(),c=At.find(f=>f.startsWith(d)&&f!==d);E(c?c.slice(r.length):"")},[r]);const X=m.useCallback((...d)=>{a(c=>[...c,...d.map(f=>({...f,id:w()}))])},[]),i=m.useCallback((d,c)=>{X({timestamp:new Date,text:d,type:c})},[X]),K=m.useCallback((d,c)=>new Promise(f=>{const C=w();a(y=>[...y,{id:C,timestamp:new Date,text:"",type:c,isStreaming:!0}]);let x=0;const v=[...d],A=v.length>500?5:v.length>200?10:15,I=()=>{if(x<v.length){const y=v.length>500?4:v.length>200?3:2,T=v.slice(x,x+y).join("");x+=y,a($=>$.map(L=>L.id===C?{...L,text:L.text+T}:L)),setTimeout(I,A)}else a(y=>y.map(T=>T.id===C?{...T,isStreaming:!1}:T)),f()};I()}),[]),Z=m.useCallback(async d=>{if(!d.trim()){i("ERROR: Usage: /agent <question>","error");return}i("[PROCESSING...] Querying Gemini AI...","system"),N(!0);try{const c=await Oe(d);if(!c)i("ERROR: Empty response from Gemini.","error");else{i("--- GEMINI RESPONSE ---","ai");const f=c.split(`
`);for(const C of f)await K(C,"ai");i("--- END RESPONSE ---","ai")}}catch(c){const f=c instanceof Error?c.message:"Unknown error occurred";i(`ERROR: Gemini request failed — ${f}`,"error"),f.includes("API_KEY")?i("HINT: Set VITE_GEMINI_API_KEY in your environment variables.","system"):(f.includes("429")||f.includes("quota"))&&i("HINT: Free tier quota exhausted. Enable billing at https://aistudio.google.com or wait for quota reset.","system")}finally{N(!1)}},[i,K]),ee=m.useCallback(async d=>{if(!d.trim()){i("ERROR: Usage: /search <query>","error");return}i(`[PROCESSING...] Searching: "${d}"`,"system"),N(!0);try{const c=`Search the web and tell me about: ${d}. Provide a concise, factual answer with key points. If this relates to Delhi, India operations, city management, or public safety, emphasize those aspects.`,f=await Oe(c);if(!f)i("ERROR: No search results returned.","error");else{i(`--- SEARCH RESULTS: "${d}" ---`,"search");const C=f.split(`
`);for(const x of C)await K(x,"search");i("--- END RESULTS ---","search")}}catch(c){const f=c instanceof Error?c.message:"Unknown error occurred";i(`ERROR: Search failed — ${f}`,"error"),(f.includes("429")||f.includes("quota"))&&i("HINT: Free tier quota exhausted. Enable billing at https://aistudio.google.com or wait for quota reset.","system")}finally{N(!1)}},[i,K]),te=m.useCallback(async d=>{const c=d.trim().split(/\s+/);if(c.length<2||!c[0]){i("ERROR: Usage: /api <METHOD> <endpoint> [body]","error"),i('  Examples: /api GET /incidents, /api POST /incidents {"type":"theft"}',"system");return}const f=c[0].toUpperCase(),C=c[1],x=c.slice(2).join(" "),v=["GET","POST","PUT","PATCH","DELETE"];if(!v.includes(f)){i(`ERROR: Invalid HTTP method "${f}". Use: ${v.join(", ")}`,"error");return}let A;if(x)try{A=JSON.parse(x)}catch{i("ERROR: Invalid JSON body. Check your syntax.","error");return}i(`[PROCESSING...] ${f} ${C}${A?" + body":""}`,"system"),N(!0);try{const I={method:f.toLowerCase(),url:C};A&&f!=="GET"&&f!=="DELETE"&&(I.data=A),A&&f==="GET"&&(I.params=A);const y=await _.request(I);i(`--- RESPONSE [${y.status} ${y.statusText}] ---`,"success");const $=z(y.data).split(`
`);for(const L of $)i(`  ${L}`,"json");i("--- END RESPONSE ---","success")}catch(I){if(I&&typeof I=="object"&&"response"in I){const y=I,T=y.response?.status??"???",$=y.response?.statusText??"";i(`ERROR: ${T} ${$}`,"error"),y.response?.data&&z(y.response.data).split(`
`).forEach($e=>{i(`  ${$e}`,"error")})}else{const y=I instanceof Error?I.message:"Request failed";i(`ERROR: ${y}`,"error")}}finally{N(!1)}},[i]),ne=m.useCallback(()=>{const d=[["","system"],["  AVAILABLE COMMANDS","ai"],["  ══════════════════════════════════════════════","system"],["","system"],["  /agent <question>        Ask Gemini AI anything","info"],["  /search <query>          Search the web via Gemini AI","info"],["  /api <METHOD> <url>      Hit backend API endpoint","info"],["       Example: /api GET /incidents","system"],['       Example: /api POST /incidents {"type":"theft"}',"system"],["  /help                    Show this help message","info"],["  /clear                   Clear terminal output","info"],["  /history                 Show command history","info"],["  /system                  Show system status","info"],["  /whoami                  Show current user info","info"],["  /exit                    Return to dashboard","info"],["","system"],["  KEYBOARD SHORTCUTS","ai"],["  ──────────────────────────────────────────────","system"],["  Enter          Execute command","system"],["  Up/Down        Navigate command history","system"],["  Tab             Autocomplete command","system"],["","system"]];for(const[c,f]of d)i(c,f)},[i]),se=m.useCallback(async()=>{i("[PROCESSING...] Fetching system status...","system"),N(!0);try{let d=null;try{d=(await _.get("/health")).data}catch{try{d=(await _.get("/status")).data}catch{}}const[c,f,C]=await Promise.allSettled([_.get("/incidents",{params:{limit:1}}),_.get("/cameras",{params:{limit:1}}),_.get("/aqi",{params:{limit:1}})]),x=c.status==="fulfilled"?c.value.data?.pagination?.total??"N/A":"ERR",v=f.status==="fulfilled"?f.value.data?.pagination?.total??"N/A":"ERR",A=C.status==="fulfilled"?C.value.data?.pagination?.total??"N/A":"ERR";i("","system"),i("  ┌──────────────────────────────────────────┐","ai"),i("  │          SYSTEM STATUS REPORT            │","ai"),i("  └──────────────────────────────────────────┘","ai"),i("","system"),d&&i(`  HEALTH CHECK:     ${z(d)}`,"success"),i(`  API ENDPOINT:     ${_.defaults.baseURL??"DEFAULT"}`,"info"),i(`  AUTH STATUS:      ${t?"AUTHENTICATED":"UNAUTHENTICATED"}`,t?"success":"error"),i(`  USER:             ${t?.email??"N/A"}`,"info"),i(`  ROLE:             ${t?.role??"N/A"}`,"info"),i(`  SESSION UPTIME:   ${k}`,"info"),i(`  COMMANDS RUN:     ${B}`,"info"),i("","system"),i("  DATA INVENTORY:","ai"),i(`    Incidents:      ${x}`,"info"),i(`    Cameras:        ${v}`,"info"),i(`    AQI Readings:   ${A}`,"info"),i("","system"),i("  GEMINI API:       CONFIGURED","success"),i("","system")}catch(d){const c=d instanceof Error?d.message:"Failed to fetch status";i(`ERROR: ${c}`,"error")}finally{N(!1)}},[i,t,k,B]),oe=m.useCallback(()=>{if(!t){i("ERROR: Not authenticated.","error");return}i("","system"),i("  ┌──────────────────────────────────────────┐","ai"),i("  │            USER IDENTITY                 │","ai"),i("  └──────────────────────────────────────────┘","ai"),i("","system"),i(`  ID:               ${t.id}`,"info"),i(`  EMAIL:            ${t.email}`,"info"),i(`  ROLE:             ${t.role}`,"info"),i(`  ADMIN ACCESS:     ${n?"GRANTED":"DENIED"}`,n?"success":"system"),i(`  WRITE ACCESS:     ${s?"GRANTED":"DENIED"}`,s?"success":"system"),i(`  SESSION UPTIME:   ${k}`,"info"),i("","system")},[i,t,n,s,k]),ae=m.useCallback(()=>{if(h.length===0){i("  No commands in history.","system");return}i("","system"),i("  COMMAND HISTORY","ai"),i("  ──────────────────────────────────────────────","system"),h.forEach((d,c)=>{i(`  ${String(h.length-c).padStart(3," ")}. ${d}`,"info")}),i("","system")},[i,h]),ie=m.useCallback(async d=>{const c=d.trim();if(!c)return;if(i(`>_ ${c}`,"input"),De(v=>v+1),!c.startsWith("/")){i('ERROR: Commands must start with "/". Type /help for available commands.',"error");return}const f=c.indexOf(" "),C=(f>-1?c.slice(0,f):c).toLowerCase(),x=f>-1?c.slice(f+1):"";switch(C){case"/agent":await Z(x);break;case"/search":await ee(x);break;case"/api":await te(x);break;case"/help":ne();break;case"/clear":a([]);break;case"/history":ae();break;case"/system":await se();break;case"/whoami":oe();break;case"/exit":i("Navigating to dashboard...","success"),setTimeout(()=>e("/"),300);break;default:i(`ERROR: Unknown command "${C}".`,"error"),i("  Type /help to see available commands.","system");break}},[i,Z,ee,te,ne,ae,se,oe,e]),je=m.useCallback(d=>{switch(d.key){case"Enter":{if(d.preventDefault(),p)return;const c=r.trim();c&&(S(f=>[c,...f]),b(-1),ie(c)),u(""),E("");break}case"ArrowUp":{if(d.preventDefault(),h.length===0)break;const c=Math.min(O+1,h.length-1);b(c),u(h[c]);break}case"ArrowDown":{if(d.preventDefault(),O<=0){b(-1),u("");break}const c=O-1;b(c),u(h[c]);break}case"Tab":{d.preventDefault(),g&&(u(c=>c+g),E(""));break}}},[r,g,h,O,ie,p]),Ge=m.useCallback(()=>{J.current?.focus()},[]);m.useEffect(()=>()=>{Le.current?.abort()},[]);const ke=m.useMemo(()=>p?l.jsxs("div",{className:"flex items-center gap-2 px-4 py-1.5 border-t border-brand/5",children:[l.jsx(Qe,{className:"h-3 w-3 text-info animate-spin"}),l.jsx("span",{className:"text-[10px] font-mono text-info tracking-wider animate-pulse",children:"[PROCESSING...]"})]}):null,[p]);return l.jsxs("div",{className:"h-full flex flex-col gap-4",children:[l.jsxs("div",{className:"flex items-center justify-between shrink-0",children:[l.jsxs("div",{children:[l.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[l.jsx(re,{className:"h-4 w-4 text-brand"}),l.jsx("h1",{className:"text-lg font-bold text-brand font-[Orbitron] tracking-widest text-glow",children:"AI TERMINAL"})]}),l.jsxs("p",{className:"text-[10px] text-gray-600 font-mono tracking-[0.2em]",children:[">"," INTEGRATED AI OPERATIONS CONSOLE // GEMINI POWERED"]})]}),l.jsxs("div",{className:"hidden md:flex items-center gap-3",children:[l.jsxs("div",{className:"flex items-center gap-2 border border-info/15 bg-info/5 px-3 py-1.5",children:[l.jsx(qe,{className:"h-3 w-3 text-info"}),l.jsx("span",{className:"text-[9px] font-mono text-info tracking-wider",children:"GEMINI 2.0 FLASH"})]}),l.jsxs("div",{className:"flex items-center gap-2 border border-brand/15 bg-brand/5 px-3 py-1.5",children:[l.jsx(Ke,{className:"h-3 w-3 text-brand"}),l.jsx("span",{className:"text-[9px] font-mono text-brand tracking-wider",children:t?.role??"N/A"})]})]})]}),l.jsxs("div",{className:"flex-1 min-h-0 bg-gray-950 border border-brand/10 corner-borders flex flex-col relative overflow-hidden",children:[l.jsx("div",{className:"absolute top-0 left-0 right-0 h-px bg-gradient-to-r from-transparent via-brand/30 to-transparent"}),l.jsxs("div",{className:"shrink-0 flex items-center justify-between px-4 py-2.5 border-b border-brand/10 bg-gray-950",children:[l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsxs("div",{className:"flex items-center gap-1.5",children:[l.jsx("div",{className:"h-2 w-2 rounded-full bg-danger"}),l.jsx("div",{className:"h-2 w-2 rounded-full bg-warning"}),l.jsx("div",{className:"h-2 w-2 rounded-full bg-brand"})]}),l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx(re,{className:"h-3.5 w-3.5 text-brand"}),l.jsx("span",{className:"text-[10px] font-mono font-bold text-brand tracking-wider",children:"DELHI_OPS_AI_TERMINAL v1.0"})]})]}),l.jsxs("div",{className:"flex items-center gap-4",children:[l.jsxs("div",{className:"flex items-center gap-1.5",children:[l.jsx(Ye,{className:`h-3 w-3 ${V==="online"?"text-brand":"text-danger"}`}),l.jsx("span",{className:`text-[9px] font-mono tracking-wider ${V==="online"?"text-brand":"text-danger"}`,children:V==="online"?"CONNECTED":"OFFLINE"})]}),l.jsxs("div",{className:"hidden sm:flex items-center gap-1.5",children:[l.jsx(Ve,{className:"h-3 w-3 text-gray-500"}),l.jsx("span",{className:"text-[9px] font-mono text-gray-500 tracking-wider",children:k})]}),l.jsxs("div",{className:"hidden sm:flex items-center gap-1.5",children:[l.jsx(We,{className:"h-3 w-3 text-gray-500"}),l.jsxs("span",{className:"text-[9px] font-mono text-gray-500 tracking-wider",children:["CMD:",B]})]}),l.jsx("div",{className:"flex items-center gap-1.5",children:l.jsx(Je,{className:`h-3 w-3 ${p?"text-info animate-pulse":"text-gray-700"}`})})]})]}),l.jsxs("div",{ref:q,className:"flex-1 min-h-0 overflow-y-auto px-4 py-3 font-mono text-[11px] leading-relaxed cursor-text data-stream-bg",onClick:Ge,children:[o.map(d=>l.jsxs("div",{className:"flex gap-3 group hover:bg-brand/[0.02]",children:[l.jsxs("span",{className:"text-gray-700 text-[9px] shrink-0 select-none leading-relaxed hidden sm:inline",children:["[",Gt(d.timestamp),"]"]}),l.jsxs("span",{className:`${wt[d.type]} whitespace-pre-wrap break-all`,children:[d.text||" ",d.isStreaming&&l.jsx("span",{className:"inline-block w-1.5 h-3 bg-current ml-0.5 animate-pulse"})]})]},d.id)),l.jsx("div",{className:"h-1"})]}),ke,l.jsxs("div",{className:"shrink-0 flex items-center gap-2 px-4 py-3 border-t border-brand/10 bg-gray-950/80",children:[l.jsxs("span",{className:"text-brand text-xs font-mono font-bold select-none flex items-center gap-1",children:[l.jsx(Be,{className:"h-3 w-3"}),l.jsx("span",{className:"typing-cursor text-brand",children:">"})]}),l.jsxs("div",{className:"relative flex-1",children:[l.jsx("input",{ref:J,type:"text",value:r,onChange:d=>u(d.target.value),onKeyDown:je,className:"w-full bg-transparent text-[12px] font-mono text-brand outline-none placeholder:text-gray-700 caret-brand",placeholder:p?"Processing... please wait":"Enter command... (start with /)",autoComplete:"off",spellCheck:!1,disabled:p,"aria-label":"Terminal command input"}),g&&!p&&l.jsxs("span",{className:"absolute left-0 top-0 text-[12px] font-mono text-gray-700 pointer-events-none select-none","aria-hidden":"true",children:[l.jsx("span",{className:"invisible",children:r}),g]})]}),l.jsx("span",{className:"text-[9px] font-mono text-gray-700 tracking-wider select-none hidden sm:inline",children:"TAB: autocomplete | UP/DOWN: history"})]})]})]})}export{Ft as default};
